<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>GTA RP Mini</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/phaser@3.80.1/dist/phaser.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/phaser3-rex-plugins@1.1.82/dist/rexvirtualjoystickplugin.min.js"></script>
    <style>
        body { margin: 0; padding: 0; background: #000; overflow: hidden; }
        #game { width: 100vw; height: 100vh; }
        #hud { position: fixed; top: 10px; left: 0; right: 0; text-align: center; background: rgba(0,0,0,0.7); padding: 10px; color: white; font-size: 18px; z-index: 10; }
        #chat { position: fixed; bottom: 10px; left: 10px; right: 10px; background: rgba(0,0,0,0.7); padding: 10px; border-radius: 10px; color: white; z-index: 10; }
        #chatMessages { height: 80px; overflow-y: auto; margin-bottom: 10px; font-size: 14px; }
        input { width: 70%; padding: 8px; border: none; border-radius: 5px; }
        button { padding: 8px 12px; background: #00ff00; border: none; border-radius: 5px; color: black; font-weight: bold; }
        #orientation-message { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: #000; color: white; display: flex; align-items: center; justify-content: center; flex-direction: column; font-size: 24px; z-index: 100; }
    </style>
</head>
<body>
    <div id="orientation-message">
        <p>üîÑ –ü–æ–≤–µ—Ä–Ω–∏ —Ç–µ–ª–µ—Ñ–æ–Ω –≤–µ—Ä—Ç–∏–∫–∞–ª—å–Ω–æ!</p>
        <p>–î–ª—è –ª—É—á—à–µ–π –∏–≥—Ä—ã</p>
    </div>
    <div id="hud">üí∞ –î–µ–Ω—å–≥–∏: <span id="money">0</span>$ | üéØ –ú–∏—Å—Å–∏—è: –°–æ–±–µ—Ä–∏ 500$</div>
    <div id="game"></div>
    <div id="chat">
        <div id="chatMessages"></div>
        <input id="chatInput" placeholder="RP —á–∞—Ç: /me —É–≥–Ω–∞–ª —Ç–∞—á–∫—É..." />
        <button onclick="sendChat()">–û—Ç–ø—Ä–∞–≤–∏—Ç—å</button>
    </div>

    <script>
        const tg = window.Telegram.WebApp;
        tg.ready();
        tg.expand();
        tg.requestFullscreen();

        const orientationMessage = document.getElementById('orientation-message');
        function checkOrientation() {
            if (window.innerHeight > window.innerWidth) {
                orientationMessage.style.display = 'none';
            } else {
                orientationMessage.style.display = 'flex';
            }
        }
        window.addEventListener('resize', checkOrientation);
        checkOrientation();

        let money = 0;
        let missionComplete = false;

        const config = {
            type: Phaser.AUTO,
            parent: 'game',
            width: window.innerWidth,
            height: window.innerHeight,
            physics: { default: 'arcade' },
            backgroundColor: '#333333',
            scene: { preload, create, update }
        };

        const game = new Phaser.Game(config);
        let player, moneyBags, joystick, gasButton, cursors;
        let gasPressed = false;

        function preload() {
            this.load.image('car', 'https://img.itch.zone/aW1nLzMxODEyMDUucG5n/315x250%23c/WAOu6X.png');
            this.load.image('police', 'https://opengameart.org/sites/default/files/police%20car%20preview.png');
            this.load.image('road', 'https://img.craftpix.net/2024/10/Path-and-Road-Top-Down-Tileset-Pixel-Art.jpg');
            this.load.image('building1', 'https://i.ytimg.com/vi/lXvwpxS--3g/maxresdefault.jpg');
            this.load.image('moneybag', 'https://www.shutterstock.com/image-vector/money-bundle-pack-pixel-art-260nw-2220859721.jpg');
            this.load.plugin('rexvirtualjoystickplugin', 'https://cdn.jsdelivr.net/npm/phaser3-rex-plugins@1.1.82/dist/rexvirtualjoystickplugin.min.js', true);
        }

        function create() {
            this.add.image(this.scale.width / 2, this.scale.height / 2, 'road').setScale(2).setDepth(-1);

            this.add.image(this.scale.width / 2 - 100, this.scale.height / 2 - 200, 'building1').setScale(0.6);
            this.add.image(this.scale.width / 2 + 200, this.scale.height / 2 + 100, 'building1').setScale(0.5);
            this.add.image(this.scale.width / 2, this.scale.height / 2 + 300, 'police').setScale(0.3);

            player = this.physics.add.sprite(this.scale.width / 2, this.scale.height / 2 + 200, 'car').setScale(0.6);

            moneyBags = this.physics.add.group();
            for (let i = 0; i < 15; i++) {
                let x = Phaser.Math.Between(100, this.scale.width * 2 - 100);
                let y = Phaser.Math.Between(100, this.scale.height * 2 - 200);
                let bag = moneyBags.create(x, y, 'moneybag').setScale(0.3);
                bag.setData('value', 100);
            }
            this.physics.add.overlap(player, moneyBags, collectMoney, null, this);

            this.cameras.main.startFollow(player);
            this.cameras.main.setBounds(0, 0, this.scale.width * 2, this.scale.height * 2);

            cursors = this.input.keyboard.createCursorKeys();

            // –°–µ–Ω—Å–æ—Ä–Ω–æ–µ —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ
            if ('ontouchstart' in window || tg.platform !== 'unknown') {
                joystick = this.plugins.get('rexvirtualjoystickplugin').add(this, {
                    x: 150,
                    y: this.scale.height - 150,
                    radius: 100,
                    base: this.add.circle(150, this.scale.height - 150, 100, 0x888888, 0.3).setDepth(10),
                    thumb: this.add.circle(150, this.scale.height - 150, 50, 0xcccccc, 0.5).setDepth(10),
                    dir: '8dir',
                    forceMin: 16
                });

                gasButton = this.add.circle(this.scale.width - 150, this.scale.height - 150, 80, 0x00ff00, 0.5).setInteractive().setDepth(10);
                this.add.text(this.scale.width - 180, this.scale.height - 180, '–ì–ê–ó', { fontSize: '24px', color: '#000' }).setOrigin(0.5).setDepth(10);

                gasButton.on('pointerdown', () => gasPressed = true);
                gasButton.on('pointerup', () =>
