<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>GTA RP Mini</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/phaser@3.80.1/dist/phaser.min.js"></script>
    <style>
        body { margin: 0; padding: 0; background: #000; overflow: hidden; }
        #game { width: 100vw; height: 100vh; }
        #hud { position: fixed; top: 10px; left: 10px; background: rgba(0,0,0,0.7); padding: 10px; border-radius: 10px; color: white; font-family: Arial; }
        #chat { position: fixed; bottom: 10px; left: 10px; right: 10px; background: rgba(0,0,0,0.7); padding: 10px; border-radius: 10px; color: white; }
        #chatMessages { height: 100px; overflow-y: auto; margin-bottom: 10px; }
        input { width: 70%; padding: 10px; border: none; border-radius: 5px; }
        button { padding: 10px; background: #00ff00; border: none; border-radius: 5px; color: black; font-weight: bold; }
    </style>
</head>
<body>
    <div id="hud">üí∞ –î–µ–Ω—å–≥–∏: <span id="money">0</span>$ | üéØ –ú–∏—Å—Å–∏—è: –°–æ–±–µ—Ä–∏ 500$</div>
    <div id="game"></div>
    <div id="chat">
        <div id="chatMessages"></div>
        <input id="chatInput" placeholder="RP —á–∞—Ç: /me —É–≥–Ω–∞–ª —Ç–∞—á–∫—É..." />
        <button onclick="sendChat()">–û—Ç–ø—Ä–∞–≤–∏—Ç—å</button>
    </div>

    <script>
        const tg = window.Telegram.WebApp;
        tg.ready();
        tg.expand();
        tg.requestFullscreen();

        let money = 0;
        let missionComplete = false;

        const config = {
            type: Phaser.AUTO,
            parent: 'game',
            width: window.innerWidth,
            height: window.innerHeight,
            physics: { default: 'arcade' },
            backgroundColor: '#1a1a1a',
            scene: { preload, create, update }
        };

        const game = new Phaser.Game(config);
        let player, cursors, moneyBags, minimap;

        function preload() {
            this.load.image('car', 'https://img.itch.zone/aW1nLzMxODEyMDUucG5n/315x250%23c/WAOu6X.png');
            this.load.image('police', 'https://opengameart.org/sites/default/files/police%20car%20preview.png');
            this.load.image('road', 'https://img.craftpix.net/2024/10/Path-and-Road-Top-Down-Tileset-Pixel-Art.jpg');
            this.load.image('building1', 'https://i.ytimg.com/vi/lXvwpxS--3g/maxresdefault.jpg');
            this.load.image('moneybag', 'https://www.shutterstock.com/image-vector/money-bundle-pack-pixel-art-260nw-2220859721.jpg');
        }

        function create() {
            this.add.image(1000, 1000, 'road').setScale(4).setDepth(-1);
            this.add.image(600, 400, 'building1').setScale(0.8);
            this.add.image(1400, 800, 'building1').setScale(0.6);
            this.add.image(800, 1400, 'building1').setScale(0.7);
            this.add.image(500, 1200, 'police').setScale(0.3);
            this.add.image(1500, 500, 'police').setScale(0.3);

            player = this.physics.add.sprite(1000, 1000, 'car').setScale(0.4);
            player.setCollideWorldBounds(false);

            moneyBags = this.physics.add.group();
            for (let i = 0; i < 10; i++) {
                let x = Phaser.Math.Between(200, 1800);
                let y = Phaser.Math.Between(200, 1800);
                let bag = moneyBags.create(x, y, 'moneybag').setScale(0.2);
                bag.setData('value', 100);
            }
            this.physics.add.overlap(player, moneyBags, collectMoney, null, this);

            this.cameras.main.startFollow(player);
            this.cameras.main.setBounds(0, 0, 2000, 2000);

            minimap = this.cameras.add(10, 10, 200, 200).setZoom(0.1).setName('mini');
            minimap.setBackgroundColor(0x000000);
            minimap.startFollow(player);

            cursors = this.input.keyboard.createCursorKeys();
        }

        function collectMoney(player, bag) {
            bag.destroy();
            money += bag.getData('value');
            document.getElementById('money').innerText = money;
            tg.HapticFeedback.impactOccurred('light');

            if (money >= 500 && !missionComplete) {
                missionComplete = true;
                tg.showAlert("üéâ –ú–∏—Å—Å–∏—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∞! –¢—ã —Å–æ–±—Ä–∞–ª 500$ ‚Äî —Ç–µ–ø–µ—Ä—å —Ç—ã –±–æ—Å—Å —Ä–∞–π–æ–Ω–∞!");
            }
        }

        function update() {
            const speed = 8;
            if (cursors.left.isDown) player.angle -= 5;
            if (cursors.right.isDown) player.angle += 5;
            if (cursors.up.isDown) {
                this.physics.velocityFromAngle(player.angle, speed * 30, player.body.velocity);
            } else if (cursors.down.isDown) {
                this.physics.velocityFromAngle(player.angle, -speed * 15, player.body.velocity);
            } else {
                player.setVelocity(0);
            }
        }

        function sendChat() {
            const input = document.getElementById('chatInput');
            const msg = input.value.trim();
            if (msg) {
                const chatDiv = document.getElementById('chatMessages');
                const username = tg.initDataUnsafe.user?.first_name || "–ò–≥—Ä–æ–∫";
                chatDiv.innerHTML += `<p><b>${username}:</b> ${msg}</p>`;
                chatDiv.scrollTop = chatDiv.scrollHeight;
                input.value = "";
            }
        }

        document.getElementById('chatInput').addEventListener('keypress', (e) => {
            if (e.key === 'Enter') sendChat();
        });
    </script>
</body>
</html>
